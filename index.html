<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Revisão de Caixas - 2D</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    *{box-sizing:border-box;font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif}
    body{
      margin:0;padding:16px;
      background:#111827;
      display:flex;flex-direction:column;align-items:center;gap:12px;
      color:#111827;
    }
    .card-form{
      width:100%;max-width:420px;
      background:#f9fafb;border-radius:16px;
      padding:14px 14px 18px;
      box-shadow:0 12px 30px rgba(0,0,0,.35);
    }
    .card-form h1{
      font-size:18px;margin:0 0 8px;font-weight:700;text-align:center;color:#111827;
    }
    .form-row{display:flex;gap:8px}
    .form-group{display:flex;flex-direction:column;gap:3px;margin-bottom:8px;flex:1}
    label{font-size:12px;font-weight:600;color:#374151}
    input,textarea,select{
      border-radius:8px;border:1px solid #d1d5db;
      padding:6px 8px;font-size:14px;outline:none;background:#fff;
    }
    input:focus,textarea:focus,select:focus{
      border-color:#6366f1;box-shadow:0 0 0 1px rgba(99,102,241,.4);
    }
    textarea{resize:vertical;min-height:60px;max-height:140px}
    .buttons{display:flex;flex-wrap:wrap;gap:8px;margin-top:6px}
    .btn{
      border:none;border-radius:999px;
      padding:8px 12px;font-size:14px;font-weight:600;cursor:pointer;
      flex:1;min-width:130px;display:flex;align-items:center;justify-content:center;
    }
    .btn-primary{background:#111827;color:#f9fafb}
    .btn-secondary{background:#e5e7eb;color:#111827}
    .btn-outline{background:transparent;border:1px solid #9ca3af;color:#e5e7eb}
    .hint{font-size:11px;color:#6b7280;margin-top:6px}
    canvas{
      width:100%;max-width:420px;border-radius:8px;
      background:#000;box-shadow:0 16px 36px rgba(0,0,0,.6);
    }
    .preview-title{color:#e5e7eb;font-size:13px}
  </style>
</head>
<body>
  <div class="card-form">
    <h1>Revisão de Caixas - 2D</h1>

    <div class="form-row">
      <div class="form-group">
        <label>Função</label>
        <select id="funcao">
          <option>Líder Técnico</option>
          <option>Preparador</option>
        </select>
      </div>
      <div class="form-group">
        <label>Responsável</label>
        <input id="responsavel" placeholder="Seu nome" />
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label>Turno</label>
        <input id="turno" placeholder="Ex.: 2º Turno" />
      </div>
      <div class="form-group">
        <label>Programa</label>
        <input id="programa" placeholder="Ex.: 710094" />
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label>Documento</label>
        <input id="documento" placeholder="Ex.: 49" />
      </div>
      <div class="form-group">
        <label>Número</label>
        <input id="numero" placeholder="Ex.: 31.32" />
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label>Qtde caixas revisadas</label>
        <input id="qtdRevisadas" type="number" min="0" />
      </div>
      <div class="form-group">
        <label>Qtde problemas</label>
        <input id="qtdProblemas" type="number" min="0" />
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label>Data</label>
        <input id="data" type="date" />
      </div>
    </div>

    <div class="form-group">
      <label>Descrição dos problemas</label>
      <textarea id="descricao" placeholder="Ex.: Bolhas e falhas nos cabeçotes"></textarea>
    </div>

    <div class="buttons">
      <button class="btn btn-primary" id="btnGerar">Gerar imagem</button>
      <button class="btn btn-secondary" id="btnDownload">Baixar PNG</button>
    </div>

    <div class="buttons">
      <button class="btn btn-outline" id="btnWhats">Texto WhatsApp</button>
    </div>

    <div class="hint">
      • A imagem gerada fica igual ao modelo da revisão.<br>
      • Você pode baixar e enviar no WhatsApp.
    </div>
  </div>

  <div class="preview-title">Preview da imagem gerada</div>
  <canvas id="canvas" width="1080" height="1920"></canvas>

  <script>
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");

    function getData() {
      const funcao = document.getElementById("funcao").value || "-";
      const responsavel = document.getElementById("responsavel").value || "-";
      const turno = document.getElementById("turno").value || "-";
      const programa = document.getElementById("programa").value || "-";
      const documento = document.getElementById("documento").value || "-";
      const numero = document.getElementById("numero").value || "-";
      const qtdRevisadas = document.getElementById("qtdRevisadas").value || "0";
      const qtdProblemas = document.getElementById("qtdProblemas").value || "0";
      const descricao = (document.getElementById("descricao").value || "-").trim();
      const dataInput = document.getElementById("data").value;
      const hoje = new Date();
      const dataFormatada = dataInput
        ? new Date(dataInput + "T00:00:00").toLocaleDateString("pt-BR")
        : hoje.toLocaleDateString("pt-BR");
      const hora = hoje.toLocaleTimeString("pt-BR", {
        hour: "2-digit",
        minute: "2-digit",
      });

      return {
        funcao,
        responsavel,
        turno,
        programa,
        documento,
        numero,
        qtdRevisadas,
        qtdProblemas,
        descricao,
        data: dataFormatada,
        hora,
      };
    }

    function wrapText(text, x, y, maxWidth, lineHeight) {
      const words = text.split(" ");
      let line = "";
      let yy = y;
      for (let n = 0; n < words.length; n++) {
        const testLine = line + words[n] + " ";
        const metrics = ctx.measureText(testLine);
        const testWidth = metrics.width;
        if (testWidth > maxWidth && n > 0) {
          ctx.fillText(line, x, yy);
          line = words[n] + " ";
          yy += lineHeight;
        } else {
          line = testLine;
        }
      }
      ctx.fillText(line, x, yy);
    }

    function draw() {
      const d = getData();

      // fundo cinza claro ao redor
      ctx.fillStyle = "#e5e5e5";
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // cartão branco central
      const margin = 90;
      const cardX = margin;
      const cardY = margin;
      const cardW = canvas.width - margin * 2;
      const cardH = canvas.height - margin * 2;
      ctx.fillStyle = "#ffffff";
      ctx.fillRect(cardX, cardY, cardW, cardH);

      // título
      ctx.fillStyle = "#000000";
      ctx.font = "bold 60px system-ui";
      ctx.textAlign = "center";
      ctx.textBaseline = "top";
      ctx.fillText("REVISÃO DE CAIXAS - 2D", canvas.width / 2, cardY + 40);

      ctx.textAlign = "left";
      let y = cardY + 140;

      // linha
      ctx.strokeStyle = "#d4d4d4";
      ctx.lineWidth = 3;
      ctx.beginPath();
      ctx.moveTo(cardX + 40, y);
      ctx.lineTo(cardX + cardW - 40, y);
      ctx.stroke();

      y += 40;
      ctx.font = "bold 42px system-ui";

      // Função / Responsável
      ctx.fillText("Função:", cardX + 40, y);
      ctx.fillText("Responsável:", cardX + cardW / 2 + 20, y);

      ctx.font = "normal 40px system-ui";
      ctx.fillText(d.funcao, cardX + 40, y + 46);
      ctx.fillText(d.responsavel, cardX + cardW / 2 + 20, y + 46);

      // Turno / Programa
      y += 120;
      ctx.font = "bold 42px system-ui";
      ctx.fillText("Turno:", cardX + 40, y);
      ctx.fillText("Programa:", cardX + cardW / 2 + 20, y);

      ctx.font = "normal 40px system-ui";
      ctx.fillText(d.turno, cardX + 40, y + 46);
      ctx.fillText(d.programa, cardX + cardW / 2 + 20, y + 46);

      // Documento / Número
      y += 120;
      ctx.font = "bold 42px system-ui";
      ctx.fillText("Documento:", cardX + 40, y);
      ctx.fillText("Número:", cardX + cardW / 2 + 20, y);

      ctx.font = "normal 40px system-ui";
      ctx.fillText(d.documento, cardX + 40, y + 46);
      ctx.fillText(d.numero, cardX + cardW / 2 + 20, y + 46);

      // Data (linha nova)
      y += 120;
      ctx.font = "bold 42px system-ui";
      ctx.fillText("Data:", cardX + 40, y);
      ctx.font = "normal 40px system-ui";
      ctx.fillText(d.data, cardX + 40, y + 46);

      // linha
      y += 120;
      ctx.strokeStyle = "#d4d4d4";
      ctx.beginPath();
      ctx.moveTo(cardX + 40, y);
      ctx.lineTo(cardX + cardW - 40, y);
      ctx.stroke();

      // Qtde caixas / Qtde problemas
      y += 40;
      ctx.font = "bold 42px system-ui";
      ctx.fillText("Qtde caixas revisadas:", cardX + 40, y);
      ctx.fillText("Qtde problemas:", cardX + cardW / 2 + 20, y);

      ctx.font = "normal 40px system-ui";
      ctx.fillText(d.qtdRevisadas, cardX + 40, y + 46);
      ctx.fillText(d.qtdProblemas, cardX + cardW / 2 + 20, y + 46);

      // linha
      y += 120;
      ctx.strokeStyle = "#d4d4d4";
      ctx.beginPath();
      ctx.moveTo(cardX + 40, y);
      ctx.lineTo(cardX + cardW - 40, y);
      ctx.stroke();

      // descrição
      y += 40;
      ctx.font = "bold 42px system-ui";
      ctx.fillStyle = "#000";
      ctx.fillText("Descrição dos problemas:", cardX + 40, y);

      y += 56;
      ctx.font = "normal 38px system-ui";
      wrapText(d.descricao, cardX + 40, y, cardW - 80, 44);

      // rodapé
      ctx.font = "normal 32px system-ui";
      ctx.fillStyle = "#9ca3af";
      ctx.textAlign = "center";
      ctx.fillText(
        `Registro gerado em ${d.data} às ${d.hora}`,
        canvas.width / 2,
        cardY + cardH - 80
      );
      ctx.textAlign = "left";
    }

    document.getElementById("btnGerar").addEventListener("click", (e)=>{
      e.preventDefault();
      draw();
    });

    document.getElementById("btnDownload").addEventListener("click",(e)=>{
      e.preventDefault();
      draw();
      const a=document.createElement("a");
      a.download="revisao-caixas-2d.png";
      a.href=canvas.toDataURL("image/png");
      a.click();
    });

    document.getElementById("btnWhats").addEventListener("click",(e)=>{
      e.preventDefault();
      const d=getData();
      const texto=[
        "REVISÃO DE CAIXAS - 2D",
        `Função: ${d.funcao}`,
        `Responsável: ${d.responsavel}`,
        `Turno: ${d.turno}`,
        `Programa: ${d.programa}`,
        `Documento: ${d.documento}`,
        `Número: ${d.numero}`,
        `Data: ${d.data}`,
        `Qtde caixas revisadas: ${d.qtdRevisadas}`,
        `Qtde problemas: ${d.qtdProblemas}`,
        "",
        "Descrição dos problemas:",
        d.descricao
      ].join("\n");
      const url="https://wa.me/?text="+encodeURIComponent(texto);
      window.open(url,"_blank");
    });

    // desenha uma vez para mostrar preview vazio
    draw();
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Revisão de Caixas - 2D</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    *{box-sizing:border-box;font-family:system-ui,-apple-system,"Segoe UI",sans-serif}
    body{
      margin:0;
      padding:16px;
      background:#f3f4f6;
      min-height:100vh;
      display:flex;
      justify-content:center;
      align-items:flex-start;
    }
    .card{
      background:#fff;
      width:100%;
      max-width:440px;
      padding:16px;
      border-radius:18px;
      box-shadow:0 8px 26px rgba(0,0,0,.18);
      border:1px solid #e5e7eb;
    }
    h1{
      font-size:20px;
      margin:0 0 10px;
      text-align:center;
      color:#111827;
    }
    .sub{
      font-size:12px;
      text-align:center;
      color:#6b7280;
      margin-bottom:12px;
    }
    label{
      font-size:12px;
      font-weight:600;
      color:#374151;
      margin-bottom:3px;
      display:block;
    }
    input,textarea,select{
      width:100%;
      padding:8px;
      border:1px solid #d1d5db;
      border-radius:10px;
      margin-bottom:10px;
      font-size:14px;
      outline:none;
      background:#fff;
    }
    input:focus,textarea:focus,select:focus{
      border-color:#111827;
      box-shadow:0 0 0 1px rgba(15,23,42,.35);
    }
    textarea{min-height:70px;resize:vertical}
    .row{display:flex;gap:8px}
    .row > div{flex:1}

    /* Botões de turno */
    .turno-buttons{
      display:flex;
      gap:8px;
      margin-bottom:10px;
    }
    .turno-buttons button{
      flex:1;
      padding:10px 0;
      border-radius:10px;
      border:1px solid #d1d5db;
      background:#f9fafb;
      font-weight:600;
      font-size:14px;
      cursor:pointer;
      transition:.15s;
    }
    .turno-buttons button.active{
      background:#111827;
      color:#fff;
      border-color:#111827;
      transform:translateY(-1px);
      box-shadow:0 4px 10px rgba(0,0,0,.25);
    }

    .btn{
      width:100%;
      padding:12px;
      margin-top:8px;
      background:#111827;
      color:white;
      border:none;
      border-radius:999px;
      font-size:15px;
      font-weight:600;
      cursor:pointer;
      box-shadow:0 6px 18px rgba(0,0,0,.25);
    }
    .btn:active{transform:translateY(1px);box-shadow:none}

    .hint{
      font-size:11px;
      color:#6b7280;
      margin-top:6px;
    }

    canvas{
      width:100%;
      max-width:440px;
      margin-top:18px;
      border-radius:12px;
      border:1px solid #e5e7eb;
      background:#fff;
      box-shadow:0 10px 28px rgba(0,0,0,.2);
    }
  </style>
</head>

<body>
  <div>
    <div class="card">
      <h1>Revisão de Caixas - 2D</h1>
      <div class="sub">Preencha os dados e toque em “Gerar & Compartilhar”.</div>

      <label>Função</label>
      <select id="funcao">
        <option>Líder Técnico</option>
        <option>Preparador</option>
      </select>

      <label>Responsável</label>
      <input id="responsavel" placeholder="Ex.: José Verlaine"/>

      <div class="row">
        <div>
          <label>Turno</label>
          <div class="turno-buttons" id="turnoBtns">
            <button type="button" data-value="1º Turno">1º</button>
            <button type="button" data-value="2º Turno">2º</button>
            <button type="button" data-value="3º Turno">3º</button>
          </div>
          <input type="hidden" id="turno" value="2º Turno">
        </div>
        <div>
          <label>Programa</label>
          <input id="programa" placeholder="Ex.: 710094"/>
        </div>
      </div>

      <div class="row">
        <div>
          <label>Documento</label>
          <input id="documento" placeholder="Ex.: 49"/>
        </div>
        <div>
          <label>Número</label>
          <input id="numero" placeholder="Ex.: 31.32"/>
        </div>
      </div>

      <label>Data</label>
      <input id="data" type="date"/>

      <div class="row">
        <div>
          <label>Qtde caixas revisadas</label>
          <input id="qtdRevisadas" type="number" min="0"/>
        </div>
        <div>
          <label>Qtde problemas</label>
          <input id="qtdProblemas" type="number" min="0"/>
        </div>
      </div>

      <label>Descrição dos problemas</label>
      <textarea id="descricao" placeholder="Ex.: Bolhas, extrias, falha de registro..."></textarea>

      <!-- BOTÃO ÚNICO -->
      <button class="btn" id="btnShare">GERAR & COMPARTILHAR</button>

      <div class="hint">
        • O botão gera a imagem do relatório e abre o menu de compartilhamento.<br>
        • Se o navegador não suportar, o PNG é baixado automaticamente.
      </div>
    </div>

    <canvas id="canvas" width="1080" height="1920"></canvas>
  </div>

<script>
const canvas=document.getElementById("canvas");
const ctx=canvas.getContext("2d");

/* --- Turnos (1º, 2º, 3º) --- */
document.querySelectorAll(".turno-buttons button").forEach(btn=>{
  btn.addEventListener("click",()=>{
    document.getElementById("turno").value=btn.dataset.value;
    document.querySelectorAll(".turno-buttons button")
      .forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
  });
});
// deixa 2º turno ativo por padrão
document.querySelector('.turno-buttons button[data-value="2º Turno"]').classList.add("active");

function getData(){
  const g=id=>document.getElementById(id).value||"-";
  const dataInput=document.getElementById("data").value;
  const hoje=new Date();
  const dataObj=dataInput?new Date(dataInput+"T00:00:00"):hoje;
  const data=dataObj.toLocaleDateString("pt-BR");
  const hora=hoje.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"});

  return{
    funcao:g("funcao"),
    responsavel:g("responsavel"),
    turno:g("turno"),
    programa:g("programa"),
    documento:g("documento"),
    numero:g("numero"),
    data,
    qtdRev:g("qtdRevisadas"),
    qtdProb:g("qtdProblemas"),
    desc:g("descricao"),
    hora
  };
}

function wrap(text,x,y,maxWidth,lineHeight){
  const words=text.split(" ");
  let line="";
  for(let n=0;n<words.length;n++){
    const testLine=line+words[n]+" ";
    if(ctx.measureText(testLine).width>maxWidth && n>0){
      ctx.fillText(line,x,y);
      line=words[n]+" ";
      y+=lineHeight;
    }else{
      line=testLine;
    }
  }
  ctx.fillText(line,x,y);
}

function draw(){
  const d=getData();
  ctx.fillStyle="#e5e5e5";
  ctx.fillRect(0,0,1080,1920);
  ctx.fillStyle="#ffffff";
  ctx.fillRect(90,90,900,1740);

  let y=170;
  ctx.fillStyle="#000";
  ctx.textAlign="center";
  ctx.font="bold 58px system-ui";
  ctx.fillText("REVISÃO DE CAIXAS - 2D",540,y);
  ctx.textAlign="left";

  y+=120;
  ctx.font="bold 42px system-ui";
  ctx.fillText("Função:",130,y);
  ctx.fillText("Responsável:",580,y);
  ctx.font="40px system-ui";
  ctx.fillText(d.funcao,130,y+46);
  ctx.fillText(d.responsavel,580,y+46);

  y+=140;
  ctx.font="bold 42px system-ui";
  ctx.fillText("Turno:",130,y);
  ctx.fillText("Programa:",580,y);
  ctx.font="40px system-ui";
  ctx.fillText(d.turno,130,y+46);
  ctx.fillText(d.programa,580,y+46);

  y+=140;
  ctx.font="bold 42px system-ui";
  ctx.fillText("Documento:",130,y);
  ctx.fillText("Número:",580,y);
  ctx.font="40px system-ui";
  ctx.fillText(d.documento,130,y+46);
  ctx.fillText(d.numero,580,y+46);

  y+=140;
  ctx.font="bold 42px system-ui";
  ctx.fillText("Data:",130,y);
  ctx.font="40px system-ui";
  ctx.fillText(d.data,130,y+46);

  y+=120;
  ctx.strokeStyle="#d4d4d4";
  ctx.lineWidth=3;
  ctx.beginPath();
  ctx.moveTo(130,y);
  ctx.lineTo(960,y);
  ctx.stroke();

  y+=40;
  ctx.font="bold 42px system-ui";
  ctx.fillText("Qtde caixas revisadas:",130,y);
  ctx.fillText("Qtde problemas:",580,y);
  ctx.font="40px system-ui";
  ctx.fillText(d.qtdRev,130,y+46);
  ctx.fillText(d.qtdProb,580,y+46);

  y+=120;
  ctx.strokeStyle="#d4d4d4";
  ctx.beginPath();
  ctx.moveTo(130,y);
  ctx.lineTo(960,y);
  ctx.stroke();

  y+=40;
  ctx.font="bold 42px system-ui";
  ctx.fillStyle="#000";
  ctx.fillText("Descrição dos problemas:",130,y);
  y+=56;
  ctx.font="38px system-ui";
  wrap(d.desc,130,y,830,44);

  ctx.font="30px system-ui";
  ctx.fillStyle="#9ca3af";
  ctx.textAlign="center";
  ctx.fillText(
    `Registro gerado em ${d.data} às ${d.hora}`,
    540,
    1770
  );
  ctx.textAlign="left";
}

async function gerarECompartilhar(){
  draw();
  canvas.toBlob(async blob=>{
    if(!blob)return;
    const file=new File([blob],"revisao-caixas-2d.png",{type:"image/png"});

    if(navigator.share && navigator.canShare && navigator.canShare({files:[file]})){
      try{
        await navigator.share({
          title:"Revisão de Caixas - 2D",
          text:"Relatório gerado pelo app de revisão de caixas.",
          files:[file]
        });
      }catch(e){console.log("Compartilhamento cancelado",e);}
    }else{
      // fallback: baixa o PNG
      const a=document.createElement("a");
      a.download="revisao-caixas-2d.png";
      a.href=URL.createObjectURL(blob);
      a.click();
      URL.revokeObjectURL(a.href);
      alert("Compartilhamento direto não suportado. O arquivo foi baixado como PNG.");
    }
  });
}

document.getElementById("btnShare").addEventListener("click",e=>{
  e.preventDefault();
  gerarECompartilhar();
});

// desenha uma prévia inicial
draw();
</script>
</body>
</html>

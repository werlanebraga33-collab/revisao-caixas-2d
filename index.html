<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Revisão de Caixas - 2D</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    *{
      box-sizing:border-box;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif
    }
    body{
      margin:0;
      padding:16px;
      background:#f3f4f6;
      min-height:100vh;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:16px;
      color:#111827;
    }
    .app-shell{
      width:100%;
      max-width:440px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    .card-form{
      width:100%;
      background:#ffffff;
      border-radius:18px;
      padding:14px 14px 16px;
      box-shadow:0 10px 30px rgba(15,23,42,.18);
      border:1px solid #e5e7eb;
    }
    .card-header{
      margin:0 0 10px;
      padding-bottom:8px;
      border-bottom:1px solid #e5e7eb;
    }
    .card-title{
      font-size:18px;
      font-weight:700;
      color:#111827;
    }
    .card-subtitle{
      font-size:12px;
      color:#6b7280;
      margin-top:2px;
    }
    .section-label{
      font-size:11px;
      font-weight:600;
      text-transform:uppercase;
      letter-spacing:0.06em;
      color:#6b7280;
      margin:8px 2px 4px;
    }
    .form-row{display:flex;gap:8px}
    .form-group{
      display:flex;
      flex-direction:column;
      gap:3px;
      margin-bottom:8px;
      flex:1;
    }
    label{
      font-size:12px;
      font-weight:600;
      color:#374151;
    }
    input,textarea,select{
      border-radius:10px;
      border:1px solid #d1d5db;
      padding:7px 9px;
      font-size:14px;
      outline:none;
      background:#ffffff;
      transition:border-color .15s,box-shadow .15s,transform .08s;
    }
    input:focus,textarea:focus,select:focus{
      border-color:#111827;
      box-shadow:0 0 0 1px rgba(15,23,42,.35);
      transform:translateY(-1px);
    }
    textarea{
      resize:vertical;
      min-height:70px;
      max-height:160px;
    }

    .buttons{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin-top:10px;
    }
    .btn{
      border:none;
      border-radius:999px;
      padding:10px 14px;
      font-size:14px;
      font-weight:600;
      cursor:pointer;
      flex:1;
      min-width:180px;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:6px;
      transition:transform .08s,box-shadow .12s,background .12s;
      white-space:nowrap;
    }
    .btn-main{
      background:#111827;
      color:#f9fafb;
      box-shadow:0 8px 18px rgba(15,23,42,.5);
    }
    .btn-main:active{
      transform:translateY(1px);
      box-shadow:none;
    }

    .hint{
      font-size:11px;
      color:#6b7280;
      margin-top:6px;
    }

    .preview-title{
      color:#4b5563;
      font-size:12px;
      padding-left:4px;
    }
    canvas{
      width:100%;
      max-width:440px;
      border-radius:14px;
      background:#ffffff;
      box-shadow:0 16px 40px rgba(15,23,42,.28);
      border:1px solid #e5e7eb;
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <div class="card-form">
      <div class="card-header">
        <div class="card-title">Revisão de Caixas - 2D</div>
        <div class="card-subtitle">
          Preencha os dados da revisão e gere um registro padronizado para envio.
        </div>
      </div>

      <div class="section-label">Identificação</div>
      <div class="form-row">
        <div class="form-group">
          <label>Função</label>
          <select id="funcao">
            <option>Líder Técnico</option>
            <option>Preparador</option>
          </select>
        </div>
        <div class="form-group">
          <label>Responsável</label>
          <input id="responsavel" placeholder="Ex.: Verlaine" />
        </div>
      </div>

      <div class="section-label">Dados da revisão</div>
      <div class="form-row">
        <div class="form-group">
          <label>Turno</label>
          <input id="turno" placeholder="Ex.: 2º Turno" />
        </div>
        <div class="form-group">
          <label>Programa</label>
          <input id="programa" placeholder="Ex.: 710094" />
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Documento</label>
          <input id="documento" placeholder="Ex.: 49" />
        </div>
        <div class="form-group">
          <label>Número</label>
          <input id="numero" placeholder="Ex.: 31.32" />
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Data</label>
          <input id="data" type="date" />
        </div>
      </div>

      <div class="section-label">Quantidades</div>
      <div class="form-row">
        <div class="form-group">
          <label>Qtde caixas revisadas</label>
          <input id="qtdRevisadas" type="number" min="0" />
        </div>
        <div class="form-group">
          <label>Qtde problemas</label>
          <input id="qtdProblemas" type="number" min="0" />
        </div>
      </div>

      <div class="section-label">Descrição dos problemas</div>
      <div class="form-group">
        <textarea id="descricao" placeholder="Ex.: Bolhas no verniz, falha de registro, falta de base em 3 pares..."></textarea>
      </div>

      <div class="buttons">
        <button class="btn btn-main" id="btnShareAll">Gerar & Compartilhar</button>
      </div>

      <div class="hint">
        • O botão acima já gera a imagem e abre o compartilhamento (WhatsApp, e-mail etc.).<br>
        • Se o compartilhamento não for suportado, o arquivo será baixado como PNG.
      </div>
    </div>

    <div class="preview-title">Prévia da imagem gerada</div>
    <canvas id="canvas" width="1080" height="1920"></canvas>
  </div>

  <script>
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");

    function getData() {
      const funcao = document.getElementById("funcao").value || "-";
      const responsavel = document.getElementById("responsavel").value || "-";
      const turno = document.getElementById("turno").value || "-";
      const programa = document.getElementById("programa").value || "-";
      const documento = document.getElementById("documento").value || "-";
      const numero = document.getElementById("numero").value || "-";
      const qtdRevisadas = document.getElementById("qtdRevisadas").value || "0";
      const qtdProblemas = document.getElementById("qtdProblemas").value || "0";
      const descricao = (document.getElementById("descricao").value || "-").trim();
      const dataInput = document.getElementById("data").value;

      const hoje = new Date();
      const dataFormatada = dataInput
        ? new Date(dataInput + "T00:00:00").toLocaleDateString("pt-BR")
        : hoje.toLocaleDateString("pt-BR");

      const hora = hoje.toLocaleTimeString("pt-BR", {
        hour:"2-digit",
        minute:"2-digit"
      });

      return {
        funcao, responsavel, turno, programa, documento,
        numero, qtdRevisadas, qtdProblemas, descricao,
        data:dataFormatada, hora
      };
    }

    function wrapText(text, x, y, maxWidth, lineHeight) {
      const words = text.split(" ");
      let line = "";
      let yy = y;
      for (let w of words) {
        const testLine = line + w + " ";
        if (ctx.measureText(testLine).width > maxWidth) {
          ctx.fillText(line, x, yy);
          line = w + " ";
          yy += lineHeight;
        } else line = testLine;
      }
      ctx.fillText(line, x, yy);
    }

    function draw() {
      const d = getData();

      // fundo
      ctx.fillStyle = "#e5e5e5";
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // cartão branco
      const m = 90;
      const cardX = m, cardY = m;
      const cardW = canvas.width - m*2;
      const cardH = canvas.height - m*2;
      ctx.fillStyle="#ffffff";
      ctx.fillRect(cardX, cardY, cardW, cardH);

      // faixa de topo
      const headerH = 130;
      ctx.fillStyle = "#111827";
      ctx.fillRect(cardX, cardY, cardW, headerH);

      ctx.fillStyle="#f9fafb";
      ctx.font="bold 58px system-ui";
      ctx.textAlign="center";
      ctx.textBaseline="top";
      ctx.fillText("REVISÃO DE CAIXAS - 2D", canvas.width/2, cardY+26);

      ctx.textAlign="left";
      let y = cardY + headerH + 30;

      // Função / Responsável
      ctx.fillStyle="#000";
      ctx.font="bold 42px system-ui";
      ctx.fillText("Função:",cardX+40,y);
      ctx.fillText("Responsável:",cardX+cardW/2+20,y);

      ctx.font="normal 40px system-ui";
      ctx.fillText(d.funcao,cardX+40,y+46);
      ctx.fillText(d.responsavel,cardX+cardW/2+20,y+46);

      // Turno / Programa
      y+=120;
      ctx.font="bold 42px system-ui";
      ctx.fillText("Turno:",cardX+40,y);
      ctx.fillText("Programa:",cardX+cardW/2+20,y);

      ctx.font="normal 40px system-ui";
      ctx.fillText(d.turno,cardX+40,y+46);
      ctx.fillText(d.programa,cardX+cardW/2+20,y+46);

      // Documento / Número
      y+=120;
      ctx.font="bold 42px system-ui";
      ctx.fillText("Documento:",cardX+40,y);
      ctx.fillText("Número:",cardX+cardW/2+20,y);

      ctx.font="normal 40px system-ui";
      ctx.fillText(d.documento,cardX+40,y+46);
      ctx.fillText(d.numero,cardX+cardW/2+20,y+46);

      // Data
      y+=120;
      ctx.font="bold 42px system-ui";
      ctx.fillText("Data:",cardX+40,y);
      ctx.font="normal 40px system-ui";
      ctx.fillText(d.data,cardX+40,y+46);

      // linha divisória
      y+=120;
      ctx.strokeStyle="#d4d4d4";
      ctx.lineWidth=3;
      ctx.beginPath();
      ctx.moveTo(cardX+40,y);
      ctx.lineTo(cardX+cardW-40,y);
      ctx.stroke();

      // Revisadas / problemas
      y+=40;
      ctx.font="bold 42px system-ui";
      ctx.fillText("Qtde caixas revisadas:",cardX+40,y);
      ctx.fillText("Qtde problemas:",cardX+cardW/2+20,y);

      ctx.font="normal 40px system-ui";
      ctx.fillText(d.qtdRevisadas,cardX+40,y+46);
      ctx.fillText(d.qtdProblemas,cardX+cardW/2+20,y+46);

      // linha
      y+=120;
      ctx.strokeStyle="#d4d4d4";
      ctx.beginPath();
      ctx.moveTo(cardX+40,y);
      ctx.lineTo(cardX+cardW-40,y);
      ctx.stroke();

      // descrição
      y+=40;
      ctx.font="bold 42px system-ui";
      ctx.fillStyle="#000";
      ctx.fillText("Descrição dos problemas:",cardX+40,y);

      y+=56;
      ctx.font="normal 38px system-ui";
      wrapText(d.descricao,cardX+40,y,cardW-80,44);

      // rodapé
      ctx.font="normal 32px system-ui";
      ctx.fillStyle="#9ca3af";
      ctx.textAlign="center";
      ctx.fillText(
        `Registro gerado em ${d.data} às ${d.hora}`,
        canvas.width/2,
        cardY+cardH-80
      );
      ctx.textAlign="left";
    }

    async function gerarECompartilhar() {
      draw();

      canvas.toBlob(async (blob) => {
        if (!blob) return;

        const file = new File([blob], "revisao-caixas-2d.png", {
          type: "image/png",
        });

        if (navigator.share && navigator.canShare && navigator.canShare({ files:[file] })) {
          try {
            await navigator.share({
              title: "Revisão de Caixas - 2D",
              text: "Relatório gerado pelo app de revisão de caixas.",
              files: [file],
            });
          } catch (err) {
            console.log("Compartilhamento cancelado:", err);
          }
        } else if (navigator.share) {
          // share sem files: manda só texto + link
          const d = getData();
          const texto = [
            "REVISÃO DE CAIXAS - 2D",
            `Função: ${d.funcao}`,
            `Responsável: ${d.responsavel}`,
            `Turno: ${d.turno}`,
            `Programa: ${d.programa}`,
            `Documento: ${d.documento}`,
            `Número: ${d.numero}`,
            `Data: ${d.data}`,
            `Qtde caixas revisadas: ${d.qtdRevisadas}`,
            `Qtde problemas: ${d.qtdProblemas}`,
            "",
            "Descrição dos problemas:",
            d.descricao
          ].join("\n");
          try {
            await navigator.share({ title: "Revisão de Caixas - 2D", text: texto });
          } catch(e){
            console.log("Compartilhamento cancelado:", e);
          }
        } else {
          // fallback: baixar PNG
          const a = document.createElement("a");
          a.download = "revisao-caixas-2d.png";
          a.href = URL.createObjectURL(blob);
          a.click();
          URL.revokeObjectURL(a.href);
          alert("Compartilhamento não suportado. O arquivo foi baixado como PNG.");
        }
      });
    }

    document.getElementById("btnShareAll").addEventListener("click", (e) => {
      e.preventDefault();
      gerarECompartilhar();
    });

    // desenha uma prévia inicial vazia
    draw();
  </script>
</body>
</html>
